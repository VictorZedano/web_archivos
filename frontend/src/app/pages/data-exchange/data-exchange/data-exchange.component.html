<div class="data-exchange-container">
    <h2>üìÇ Gestor Registros Clinicos</h2>

    <div class="main-layout">
        <section class="upload-section card">
            <h3>Cargar Registros</h3>
            <p *ngIf="mensajeError" class="alert error">{{ mensajeError }}</p>
            <p *ngIf="mensajeCarga" class="alert success">{{ mensajeCarga }}</p>
            <div class="file-drop-area bordered-box">
                <input type="file" id="fileInput" (change)="onArchivoSeleccionado($event)" accept=".xlsx, .xls"
                    style="display: none;">
                <label for="fileInput" class="drop-label">
                    <span *ngIf="!archivoSeleccionado">Haz clic aqu√≠ para buscar</span>
                    <span *ngIf="archivoSeleccionado" class="selected-file-name">‚úÖ Archivo listo: {{
                        archivoSeleccionado.name }}</span>
                </label>
            </div>
            <div class="action-buttons import-group">
                <button (click)="subirArchivo()" [disabled]="!archivoSeleccionado || cargando" class="btn-primary">
                    <span *ngIf="!cargando">Iniciar Carga</span>
                    <span *ngIf="cargando">Procesando...</span>
                </button>
            </div>
        </section>
        <section class="export-section card">
            <h3>Exportaci√≥n de Datos</h3>
            <p>Selecciona el tipo de informaci√≥n que deseas descargar en formato Excel:</p>
            <div class="action-buttons export-group">
                <button (click)="exportarLogHistorial()" class="btn-secondary">Historial de Registros</button>
                <button (click)="exportarDatosClinicos()" class="btn-primary export-data-btn">Datos
                    Registros</button>
            </div>
        </section>
    </div>
    <section class="history-section card">
        <h3>Historial de Registros</h3>
        <div class="table-scroll">
            <table class="transaction-table">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Archivo</th>
                        <th>Usuario</th>
                        <th>Registros</th>
                        <th>Estado</th>
                        <th>Resultados</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let record of historial">
                        <td>{{ record.uploadDate | date: 'medium' }}</td>
                        <td>{{ record.fileName }}</td>
                        <td>{{ record.uploadedBy }}</td>
                        <td>{{ record.totalRecords }}</td>
                        <td>
                            <span
                                [ngClass]="{'status-success': record.status === 'EXITO', 'status-partial': record.status === 'FALLO_PARCIAL', 'status-failure': record.status === 'FALLO_TOTAL', 'status-pending': record.status === 'EN_PROCESO'}"
                                class="status-badge">
                                {{ record.status }}
                            </span>
                        </td>
                        <td>
                            <span *ngIf="record.status !== 'EN_PROCESO'">‚úîÔ∏è {{ record.successRecords }} / ‚ùå {{
                                record.errorRecords }}</span>
                            <span *ngIf="record.status === 'EN_PROCESO'">Esperando...</span>
                        </td>
                        <td>
                            <button *ngIf="record.errorFileAvailable && record.status !== 'EN_PROCESO'"
                                (click)="descargarArchivoError(record.id, record.fileName)" class="btn-download">‚¨áÔ∏è
                                Errores</button>
                            <span *ngIf="!record.errorFileAvailable && record.status === 'EXITO'">Sin errores</span>
                        </td>
                    </tr>
                    <tr *ngIf="historial.length === 0">
                        <td colspan="7" class="no-records">No hay registros de transacciones.</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>
</div>